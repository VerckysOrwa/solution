[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-10-22 05:14:08.208814",
  "module": "Verckys Interview Solution",
  "name": "Sales Order",
  "script": "// frappe.ui.form.on('Sales Order', {\n// \ton_submit(frm) {\n// \t    let {name,item_to_manufacture,manufactured_item_quantity}=frm.doc\n// \t    frappe.call({\n//         method:\"verckys_interview_solution.services.rest.create_work_order\",\n//         args:{\n//             docName:name,\n//             item:item_to_manufacture,\n//             qty:manufactured_item_quantity\n//         },\n//         callback:(r)=>{\n//             if(r.message==\"success\"){\n//                 frappe.msgprint(\"Work Order Created Successfully\")\n//             }\n//         }\n//     })\n// \t}\n// })\n\n\nfrappe.ui.form.on('Sales Order', {\n\trefresh(frm) {\n\t    if(frm.doc.status==\"To Deliver and Bill\" && frm.doc.is_manufactured==1){\n\t        \n    frm.add_custom_button(__(\"Create Custom Work Order\"), function() {\n\n        let dialog = new frappe.ui.Dialog({\n        title: __('Select items to manufacture'),\n        fields: [\n            {\n                label: 'Items',\n                fieldtype: 'Section Break',\n                collapsible: 0\n            },\n            {\n                fieldname: 'items',\n                fieldtype: 'Table',\n                cannot_add_rows: false,\n                data: [],\n                fields: [\n                    {\n                        fieldname: 'item_code',\n                        fieldtype: 'Link',\n                        options: 'Item',\n                        in_list_view: 1,\n                        label: 'Item Code'\n                    },\n                    {\n                        fieldname: 'select_bom',\n                        fieldtype: 'Link',\n                        options: 'BOM',\n                        in_list_view: 1,\n                        label: 'Select BOM',\n                        reqd: 1\n                    },\n                    {\n                        fieldname: 'qty',\n                        fieldtype: 'Float',\n                        in_list_view: 1,\n                        label: 'Qty',\n                        reqd: 1\n                    }\n                ]\n            }\n        ],\n        primary_action_label: 'Create',\n        \n        \n        primary_action(values) {\n            if (!values.items || !values.items.length) {\n                frappe.msgprint(__('select itEms to manufacture'));\n                return;\n            }\n\n            values.items.forEach(item => {\n                \n                \n                    frappe.call({\n                    method:\"verckys_interview_solution.services.rest.create_work_order\",\n                    args:{\n                        item: item.item_code,\n                        bom_no: item.select_bom,\n                        qty: item.qty,\n                        docName: frm.doc.name,\n                    },\n                    callback:(r)=>{\n                        if(r.message==\"success\"){\n                            frappe.msgprint(\"Custom Work Order Created Successfully\")\n                        }\n                    }\n                })\n                \n            });\n            \n            dialog.hide();\n        }\n    });\n\n    let items = frm.doc.items.map(item => ({\n        'item_code': item.item_code,\n        'select_bom': '',\n        'qty': item.qty\n    }));\n    \n    dialog.set_value('items', items);\n    \n    dialog.show();\n});\n\t}\n\t        \n\t    }\n})",
  "view": "Form"
 }
]